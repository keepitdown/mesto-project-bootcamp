(()=>{"use strict";var e="https://nomoreparties.co/v1/",t="wbf-cohort-2",n="4803648b-3623-4d3d-822d-5bca5bb3f6a1",o={},r=document.querySelector(".profile-info__profile-pic"),i=document.querySelector("#change-pic-btn"),c=document.querySelector(".profile-info__profile-name"),a=document.querySelector(".profile-info__profile-description"),u=document.querySelector("#profile-edit-btn"),l=document.querySelector("#add-image-btn"),s=document.querySelector(".gallery__list"),d=document.querySelectorAll(".popup"),m=document.querySelector("#change-profile-pic-window"),f=document.forms["change-profile-pic-form"],p=f.elements["profile-pic-link"],v=m.querySelectorAll(".popup__input-error-message"),_=f.elements["save-profile-pic-btn"],h=document.querySelector("#profile-editor-window"),y=document.forms["profile-info-edit-form"],b=y.elements["profile-name"],S=y.elements["profile-description"],g=h.querySelectorAll(".popup__input-error-message"),k=y.elements["save-profile-changes-btn"],E=document.querySelector("#new-image-window"),L=document.forms["new-image-form"],q=L.elements["image-name"],C=L.elements["image-link"],w=E.querySelectorAll(".popup__input-error-message"),A=L.elements["create-image-btn"],x=document.querySelector("#image-viewer-window"),T=x.querySelector("#image-viewer-image"),z=x.querySelector("#image-viewer-caption"),D=document.querySelector("#card-delete-confirm-window"),P=document.forms["confirm-card-delete-form"],j=P.elements["comfirm-card-delete-btn"];function B(e){e.classList.add("popup_opened"),window.addEventListener("keydown",O)}function N(e){e.classList.remove("popup_opened"),window.removeEventListener("keydown",O)}function O(e){"Escape"===e.key&&N(document.querySelector(".popup_opened"))}function J(e){console.log(e)}function G(e,t){c.textContent=e,a.textContent=t,document.title="".concat(e,"  - Mesto")}function H(e){r.src=e}function M(e){e.reset()}function V(e,t,n){t?(e.textContent=n,e.setAttribute("disabled","")):(e.textContent=n,e.removeAttribute("disabled"))}function U(e){e.forEach((function(e){return e.textContent=""}))}function F(e){Array.from(e.elements).forEach((function(e){return e.classList.remove("popup__input-field_invalid")}))}function I(e){e.classList.add("popup__submit-btn_disabled"),e.setAttribute("disabled","")}function K(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function Q(e,t,n){t.textContent=n.likes.length,n.likes.some((function(e){return e._id===o._id}))?(e.classList.add("image-card__like-btn_active"),n.isLiked=!0):(e.classList.remove("image-card__like-btn_active"),n.isLiked=!1)}var R,W,X=document.querySelector("#image-card-template");function Y(r){var i=X.content.querySelector(".image-card").cloneNode(!0);i.dataset.id=r._id;var c=i.querySelector(".image-card__image");i.querySelector(".image-card__title").textContent=r.name,c.alt=r.name,c.src=r.link,r.isLiked=!1;var a=i.querySelector(".image-card__like-btn"),u=i.querySelector(".image-card__like-count");Q(a,u,r),a.addEventListener("click",(function(){return function(o,r,i){(function(o){var r=o.isLiked?"DELETE":"PUT";return fetch("".concat(e).concat(t,"/cards/likes/").concat(o._id),{method:r,headers:{authorization:n}}).then(K)})(o).then((function(e){o.likes=e.likes,Q(r,i,o)})).catch(J)}(r,a,u)}));var l=i.querySelector(".image-card__remove-card-btn");return r.owner._id===o._id?l.addEventListener("click",(function(){return e=r._id,B(D),void(R=e);var e})):l.remove(),c.addEventListener("click",(function(){return function(e){!function(e){T.src=e.link,T.alt=e.name,z.textContent=e.name}(e),B(x)}(r)})),i}i.addEventListener("click",(function(){M(f),U(v),F(f),I(_),B(m)})),u.addEventListener("click",(function(){b.value=c.textContent,S.value=a.textContent,U(g),F(y),I(k),B(h)})),l.addEventListener("click",(function(){M(L),U(w),F(L),I(A),B(E)})),f.addEventListener("submit",(function(r){var i;r.preventDefault(),V(_,!0,"Сохранение..."),(i=p.value,fetch("".concat(e).concat(t,"/users/me/avatar"),{method:"PATCH",headers:{authorization:n,"Content-Type":"application/json"},body:JSON.stringify({avatar:i})}).then(K)).then((function(e){o.avatar=e.avatar,H(o.avatar),N(m)})).catch(J).finally((function(){return V(_,!1,"Сохранить")}))})),y.addEventListener("submit",(function(r){r.preventDefault(),V(k,!0,"Сохранение..."),function(o,r){return fetch("".concat(e).concat(t,"/users/me"),{method:"PATCH",headers:{authorization:n,"Content-Type":"application/json"},body:JSON.stringify({name:o,about:r})}).then(K)}(b.value,S.value).then((function(e){o.name=e.name,o.about=e.about,G(o.name,o.about),N(h)})).catch(J).finally((function(){return V(k,!1,"Сохранить")}))})),L.addEventListener("submit",(function(o){var r;o.preventDefault(),V(A,!0,"Сохранение..."),(r={name:q.value,link:C.value},fetch("".concat(e).concat(t,"/cards"),{method:"POST",headers:{authorization:n,"Content-Type":"application/json"},body:JSON.stringify({name:r.name,link:r.link})}).then(K)).then((function(e){var t=Y(e);s.prepend(t),N(E)})).catch(J).finally((function(){return V(A,!1,"Создать")}))})),d.forEach((function(e){e.addEventListener("click",(function(t){(t.target.classList.contains("popup")||t.target.classList.contains("popup__close-btn"))&&N(e)}))})),P.addEventListener("submit",(function(o){var r;o.preventDefault(),V(j,!0,"Удаление..."),(r=R,fetch("".concat(e).concat(t,"/cards/").concat(r),{method:"DELETE",headers:{authorization:n}}).then(K)).then((function(){!function(e){var t=s.querySelector('[data-id="'.concat(e,'"'));t.classList.add("image-card_deleted"),setTimeout((function(e){return e.remove()}),300,t)}(R),N(D)})).catch(J).finally((function(){return V(j,!1,"Да")}))})),Promise.all([fetch("".concat(e).concat(t,"/users/me"),{method:"GET",headers:{authorization:n}}).then(K),fetch("".concat(e).concat(t,"/cards"),{method:"GET",headers:{authorization:n}}).then(K)]).then((function(e){!function(e){for(var t in e)o[t]=e[t];G(o.name,o.about),H(o.avatar)}(e[0]),e[1].forEach((function(e){var t=Y(e);s.append(t)}))})).catch(J),W={formSelector:"popup__form",inputSelector:"popup__input-field",submitButtonSelector:"popup__submit-btn",inactiveButtonClass:"popup__submit-btn_disabled",inputErrorClass:"popup__input-field_invalid",errorClass:"popup__input-error-message"},document.querySelectorAll(".".concat(W.formSelector)).forEach((function(e){return function(e,t){var n=e.querySelector(".".concat(t.submitButtonSelector));e.querySelectorAll(".".concat(t.inputSelector)).forEach((function(o){return function(e,t,n,o){var r=t.parentElement.querySelector(".".concat(o.errorClass));t.addEventListener("input",(function(){!function(e,t,n){e.checkValidity()?(e.classList.remove(n.inputErrorClass),t.textContent=""):(e.classList.add(n.inputErrorClass),t.textContent=e.validationMessage)}(t,r,o),function(e,t,n){e.checkValidity()?(t.classList.remove(n.inactiveButtonClass),t.removeAttribute("disabled")):(t.classList.add(n.inactiveButtonClass),t.setAttribute("disabled",""))}(e,n,o)}))}(e,o,n,t)}))}(e,W)}))})();